<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Fornecedores - Sistema de Emissão de Passagens</title>

    <!-- Bootstrap 5 -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.0/font/bootstrap-icons.css">

    <!-- Custom CSS -->
    <link rel="stylesheet" href="css/style.css">
</head>
<body>
    <!-- Navbar -->
    <nav class="navbar navbar-expand-lg navbar-dark bg-primary">
        <div class="container-fluid">
            <a class="navbar-brand" href="index.html">
                <i class="bi bi-airplane-fill me-2"></i>
                VoeComKennedy
            </a>
            <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarNav">
                <span class="navbar-toggler-icon"></span>
            </button>
            <div class="collapse navbar-collapse" id="navbarNav">
                <ul class="navbar-nav ms-auto">
                    <li class="nav-item">
                        <a class="nav-link" href="index.html">
                            <i class="bi bi-house-fill"></i> Dashboard
                        </a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="vendas.html">
                            <i class="bi bi-cart-fill"></i> Vendas
                        </a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="clientes.html">
                            <i class="bi bi-people-fill"></i> Clientes
                        </a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link active" href="fornecedores.html">
                            <i class="bi bi-building"></i> Fornecedores
                        </a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="checkin.html">
                            <i class="bi bi-clock-fill"></i> Check-in
                        </a>
                    </li>
                </ul>
            </div>
        </div>
    </nav>

    <!-- Main Content -->
    <div class="container-fluid py-4">
        <div class="row mb-4">
            <div class="col-12">
                <h2><i class="bi bi-building me-2"></i>Gerenciamento de Fornecedores</h2>
                <p class="text-muted">Cadastre companhias aéreas e consolidadoras</p>
            </div>
        </div>

        <!-- Botão Novo Fornecedor -->
        <div class="row mb-4">
            <div class="col-12">
                <button class="btn btn-primary btn-lg" onclick="abrirModalFornecedor()">
                    <i class="bi bi-plus-circle me-2"></i>Novo Fornecedor
                </button>
            </div>
        </div>

        <!-- Busca e Filtros -->
        <div class="row mb-4">
            <div class="col-12">
                <div class="card">
                    <div class="card-body">
                        <div class="row">
                            <div class="col-md-6 mb-2">
                                <label class="form-label">Buscar</label>
                                <input type="text" class="form-control" id="busca" placeholder="Nome, CNPJ ou código IATA...">
                            </div>
                            <div class="col-md-3 mb-2">
                                <label class="form-label">Tipo</label>
                                <select class="form-select" id="filtroTipo" onchange="aplicarFiltros()">
                                    <option value="todos">Todos</option>
                                    <option value="cia_aerea">Companhia Aérea</option>
                                    <option value="consolidadora">Consolidadora</option>
                                    <option value="agencia">Agência</option>
                                    <option value="outro">Outro</option>
                                </select>
                            </div>
                            <div class="col-md-3 mb-2">
                                <label class="form-label">Ordenar por</label>
                                <select class="form-select" id="ordenacao" onchange="aplicarFiltros()">
                                    <option value="nome_asc">Nome (A-Z)</option>
                                    <option value="nome_desc">Nome (Z-A)</option>
                                    <option value="data_desc">Cadastro (mais recente)</option>
                                </select>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Lista de Fornecedores -->
        <div class="row" id="cardsFornecedores">
            <div class="col-12">
                <div class="empty-state">
                    <i class="bi bi-building"></i>
                    <p>Nenhum fornecedor cadastrado. Clique em "Novo Fornecedor" para começar.</p>
                </div>
            </div>
        </div>
    </div>

    <!-- Modal de Cadastro/Edição de Fornecedor -->
    <div class="modal fade" id="modalFornecedor" tabindex="-1">
        <div class="modal-dialog modal-lg">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="tituloModal">
                        <i class="bi bi-plus-circle me-2"></i>Novo Fornecedor
                    </h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body">
                    <form id="formFornecedor">
                        <input type="hidden" id="fornecedorId">

                        <div class="row">
                            <div class="col-md-8 mb-3">
                                <label class="form-label">Nome / Razão Social *</label>
                                <input type="text" class="form-control" id="nome" required placeholder="Ex: LATAM Airlines Brasil">
                            </div>
                            <div class="col-md-4 mb-3">
                                <label class="form-label">Tipo *</label>
                                <select class="form-select" id="tipo" required>
                                    <option value="">Selecione</option>
                                    <option value="cia_aerea">Companhia Aérea</option>
                                    <option value="consolidadora">Consolidadora</option>
                                    <option value="agencia">Agência</option>
                                    <option value="outro">Outro</option>
                                </select>
                            </div>
                        </div>

                        <div class="row">
                            <div class="col-md-6 mb-3">
                                <label class="form-label">Código IATA</label>
                                <input type="text" class="form-control" id="codigoIATA" placeholder="Ex: LA (LATAM), G3 (GOL)" maxlength="3">
                                <small class="text-muted">Código de 2 ou 3 letras da companhia aérea</small>
                            </div>
                            <div class="col-md-6 mb-3">
                                <label class="form-label">CNPJ</label>
                                <input type="text" class="form-control" id="cnpj" placeholder="00.000.000/0000-00" maxlength="18">
                            </div>
                        </div>

                        <h6 class="mb-3 mt-4"><i class="bi bi-envelope me-2"></i>Contato</h6>

                        <div class="row">
                            <div class="col-md-6 mb-3">
                                <label class="form-label">Email</label>
                                <input type="email" class="form-control" id="email" placeholder="contato@fornecedor.com">
                            </div>
                            <div class="col-md-6 mb-3">
                                <label class="form-label">Telefone</label>
                                <input type="text" class="form-control" id="telefone" placeholder="(00) 0000-0000" maxlength="15">
                            </div>
                        </div>

                        <div class="row">
                            <div class="col-12 mb-3">
                                <label class="form-label">Site</label>
                                <input type="url" class="form-control" id="site" placeholder="https://www.fornecedor.com">
                            </div>
                        </div>

                        <h6 class="mb-3 mt-4"><i class="bi bi-info-circle me-2"></i>Informações Adicionais</h6>

                        <div class="row">
                            <div class="col-12 mb-3">
                                <label class="form-label">Observações</label>
                                <textarea class="form-control" id="observacoes" rows="3" placeholder="Informações adicionais, políticas de bagagem, contatos específicos, etc."></textarea>
                            </div>
                        </div>
                    </form>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancelar</button>
                    <button type="button" class="btn btn-primary" onclick="salvarFornecedor()">
                        <i class="bi bi-save me-2"></i>Salvar
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- Bootstrap JS -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>

    <!-- Custom JS -->
    <script src="js/storage.js"></script>
    <script src="js/utils.js"></script>

    <script>
        let modalFornecedor;
        let fornecedorEditandoId = null;

        // Inicializar
        document.addEventListener('DOMContentLoaded', () => {
            modalFornecedor = new bootstrap.Modal(document.getElementById('modalFornecedor'));
            carregarFornecedores();

            // Máscara CNPJ
            document.getElementById('cnpj').addEventListener('input', function() {
                let valor = this.value.replace(/\D/g, '');
                valor = valor.substring(0, 14);
                valor = valor.replace(/(\d{2})(\d)/, '$1.$2');
                valor = valor.replace(/(\d{3})(\d)/, '$1.$2');
                valor = valor.replace(/(\d{3})(\d)/, '$1/$2');
                valor = valor.replace(/(\d{4})(\d)/, '$1-$2');
                this.value = valor;
            });

            // Máscara telefone
            document.getElementById('telefone').addEventListener('input', function() {
                Utils.aplicarMascaraTelefone(this);
            });

            // Busca
            document.getElementById('busca').addEventListener('input', aplicarFiltros);
        });

        // Abrir modal
        function abrirModalFornecedor(fornecedorId = null) {
            fornecedorEditandoId = fornecedorId;

            if (fornecedorId) {
                const fornecedor = StorageManager.getFornecedorById(fornecedorId);
                if (!fornecedor) return;

                document.getElementById('tituloModal').innerHTML = '<i class="bi bi-pencil me-2"></i>Editar Fornecedor';
                document.getElementById('fornecedorId').value = fornecedor.id;
                document.getElementById('nome').value = fornecedor.nome;
                document.getElementById('tipo').value = fornecedor.tipo;
                document.getElementById('codigoIATA').value = fornecedor.codigoIATA || '';
                document.getElementById('cnpj').value = fornecedor.cnpj || '';
                document.getElementById('email').value = fornecedor.email || '';
                document.getElementById('telefone').value = fornecedor.telefone || '';
                document.getElementById('site').value = fornecedor.site || '';
                document.getElementById('observacoes').value = fornecedor.observacoes || '';
            } else {
                document.getElementById('tituloModal').innerHTML = '<i class="bi bi-plus-circle me-2"></i>Novo Fornecedor';
                document.getElementById('formFornecedor').reset();
                document.getElementById('fornecedorId').value = '';
            }

            modalFornecedor.show();
        }

        // Salvar fornecedor
        function salvarFornecedor() {
            const form = document.getElementById('formFornecedor');
            if (!form.checkValidity()) {
                form.reportValidity();
                return;
            }

            const fornecedor = {
                nome: document.getElementById('nome').value,
                tipo: document.getElementById('tipo').value,
                codigoIATA: document.getElementById('codigoIATA').value.toUpperCase(),
                cnpj: document.getElementById('cnpj').value,
                email: document.getElementById('email').value,
                telefone: document.getElementById('telefone').value,
                site: document.getElementById('site').value,
                observacoes: document.getElementById('observacoes').value
            };

            if (fornecedorEditandoId) {
                StorageManager.updateFornecedor(fornecedorEditandoId, fornecedor);
                Utils.showSuccess('Fornecedor atualizado com sucesso!');
            } else {
                StorageManager.addFornecedor(fornecedor);
                Utils.showSuccess('Fornecedor cadastrado com sucesso!');
            }

            modalFornecedor.hide();
            carregarFornecedores();
        }

        // Excluir fornecedor
        function excluirFornecedor(id) {
            if (!Utils.confirm('Tem certeza que deseja excluir este fornecedor?')) return;

            if (StorageManager.deleteFornecedor(id)) {
                Utils.showSuccess('Fornecedor excluído com sucesso!');
                carregarFornecedores();
            }
        }

        // Carregar fornecedores
        function carregarFornecedores() {
            aplicarFiltros();
        }

        // Aplicar filtros
        function aplicarFiltros() {
            let fornecedores = StorageManager.getFornecedores();

            // Busca
            const busca = document.getElementById('busca').value;
            if (busca) {
                fornecedores = Utils.filtrarPorTexto(fornecedores, busca, ['nome', 'cnpj', 'codigoIATA']);
            }

            // Filtro de tipo
            const tipo = document.getElementById('filtroTipo').value;
            if (tipo !== 'todos') {
                fornecedores = fornecedores.filter(f => f.tipo === tipo);
            }

            // Ordenação
            const ordenacao = document.getElementById('ordenacao').value;
            switch(ordenacao) {
                case 'nome_asc':
                    fornecedores = Utils.ordenarPorNome(fornecedores, 'nome', 'asc');
                    break;
                case 'nome_desc':
                    fornecedores = Utils.ordenarPorNome(fornecedores, 'nome', 'desc');
                    break;
                case 'data_desc':
                    fornecedores = Utils.ordenarPorData(fornecedores, 'dataCadastro', 'desc');
                    break;
            }

            exibirFornecedores(fornecedores);
        }

        // Exibir fornecedores
        function exibirFornecedores(fornecedores) {
            const container = document.getElementById('cardsFornecedores');

            if (fornecedores.length === 0) {
                container.innerHTML = `
                    <div class="col-12">
                        <div class="empty-state">
                            <i class="bi bi-building"></i>
                            <p>Nenhum fornecedor encontrado.</p>
                        </div>
                    </div>
                `;
                return;
            }

            const tipoLabels = {
                'cia_aerea': 'Companhia Aérea',
                'consolidadora': 'Consolidadora',
                'agencia': 'Agência',
                'outro': 'Outro'
            };

            const tipoIcons = {
                'cia_aerea': 'bi-airplane',
                'consolidadora': 'bi-boxes',
                'agencia': 'bi-shop',
                'outro': 'bi-briefcase'
            };

            const tipoBadges = {
                'cia_aerea': 'bg-primary',
                'consolidadora': 'bg-success',
                'agencia': 'bg-info',
                'outro': 'bg-secondary'
            };

            let html = '';
            fornecedores.forEach(fornecedor => {
                const icon = tipoIcons[fornecedor.tipo] || 'bi-building';
                const badge = tipoBadges[fornecedor.tipo] || 'bg-secondary';
                const tipoLabel = tipoLabels[fornecedor.tipo] || 'Outro';

                html += `
                    <div class="col-md-6 col-lg-4 mb-3">
                        <div class="card h-100">
                            <div class="card-body">
                                <div class="d-flex justify-content-between align-items-start mb-3">
                                    <h5 class="card-title mb-0">
                                        <i class="bi ${icon} me-2 text-primary"></i>
                                        ${fornecedor.nome}
                                    </h5>
                                    <span class="badge ${badge}">${tipoLabel}</span>
                                </div>
                                <hr>

                                ${fornecedor.codigoIATA ? `
                                    <p class="card-text mb-2">
                                        <strong><i class="bi bi-tag me-2"></i>Código IATA:</strong>
                                        <span class="badge bg-dark">${fornecedor.codigoIATA}</span>
                                    </p>
                                ` : ''}

                                ${fornecedor.cnpj ? `
                                    <p class="card-text mb-2">
                                        <strong><i class="bi bi-card-text me-2"></i>CNPJ:</strong>
                                        ${fornecedor.cnpj}
                                    </p>
                                ` : ''}

                                ${fornecedor.email ? `
                                    <p class="card-text mb-2">
                                        <strong><i class="bi bi-envelope me-2"></i>Email:</strong>
                                        ${fornecedor.email}
                                    </p>
                                ` : ''}

                                ${fornecedor.telefone ? `
                                    <p class="card-text mb-2">
                                        <strong><i class="bi bi-telephone me-2"></i>Telefone:</strong>
                                        ${Utils.formatPhone(fornecedor.telefone)}
                                    </p>
                                ` : ''}

                                ${fornecedor.site ? `
                                    <p class="card-text mb-2">
                                        <strong><i class="bi bi-globe me-2"></i>Site:</strong>
                                        <a href="${fornecedor.site}" target="_blank" class="text-decoration-none">Acessar</a>
                                    </p>
                                ` : ''}

                                ${fornecedor.observacoes ? `
                                    <p class="card-text mb-2">
                                        <small class="text-muted">${fornecedor.observacoes}</small>
                                    </p>
                                ` : ''}
                            </div>
                            <div class="card-footer bg-transparent">
                                <button class="btn btn-sm btn-primary" onclick="abrirModalFornecedor('${fornecedor.id}')">
                                    <i class="bi bi-pencil me-1"></i>Editar
                                </button>
                                <button class="btn btn-sm btn-danger" onclick="excluirFornecedor('${fornecedor.id}')">
                                    <i class="bi bi-trash me-1"></i>Excluir
                                </button>
                            </div>
                        </div>
                    </div>
                `;
            });

            container.innerHTML = html;
        }
    </script>
</body>
</html>
