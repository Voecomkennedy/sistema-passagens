<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Clientes - Sistema de Emissão de Passagens</title>

    <!-- Bootstrap 5 -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.0/font/bootstrap-icons.css">

    <!-- Custom CSS -->
    <link rel="stylesheet" href="css/style.css">
</head>
<body>
    <!-- Navbar -->
    <nav class="navbar navbar-expand-lg navbar-dark bg-primary">
        <div class="container-fluid">
            <a class="navbar-brand" href="index.html">
                <i class="bi bi-airplane-fill me-2"></i>
                VoeComKennedy
            </a>
            <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarNav">
                <span class="navbar-toggler-icon"></span>
            </button>
            <div class="collapse navbar-collapse" id="navbarNav">
                <ul class="navbar-nav ms-auto">
                    <li class="nav-item">
                        <a class="nav-link" href="index.html">
                            <i class="bi bi-house-fill"></i> Dashboard
                        </a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="vendas.html">
                            <i class="bi bi-cart-fill"></i> Vendas
                        </a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link active" href="clientes.html">
                            <i class="bi bi-people-fill"></i> Clientes
                        </a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="fornecedores.html">
                            <i class="bi bi-building"></i> Fornecedores
                        </a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="checkin.html">
                            <i class="bi bi-clock-fill"></i> Check-in
                        </a>
                    </li>
                </ul>
            </div>
        </div>
    </nav>

    <!-- Main Content -->
    <div class="container-fluid py-4">
        <div class="row mb-4">
            <div class="col-12">
                <h2><i class="bi bi-people-fill me-2"></i>Gerenciamento de Clientes</h2>
                <p class="text-muted">Cadastre e gerencie seus clientes</p>
            </div>
        </div>

        <!-- Botão Novo Cliente -->
        <div class="row mb-4">
            <div class="col-12">
                <button class="btn btn-success btn-lg" onclick="abrirModalCliente()">
                    <i class="bi bi-person-plus me-2"></i>Novo Cliente
                </button>
            </div>
        </div>

        <!-- Busca -->
        <div class="row mb-4">
            <div class="col-12">
                <div class="card">
                    <div class="card-body">
                        <div class="row">
                            <div class="col-md-8 mb-2">
                                <label class="form-label">Buscar</label>
                                <input type="text" class="form-control" id="busca" placeholder="Nome, CPF, email ou telefone...">
                            </div>
                            <div class="col-md-4 mb-2">
                                <label class="form-label">Ordenar por</label>
                                <select class="form-select" id="ordenacao" onchange="aplicarFiltros()">
                                    <option value="nome_asc">Nome (A-Z)</option>
                                    <option value="nome_desc">Nome (Z-A)</option>
                                    <option value="data_desc">Cadastro (mais recente)</option>
                                    <option value="data_asc">Cadastro (mais antigo)</option>
                                </select>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Cards de Clientes -->
        <div class="row" id="cardsClientes">
            <div class="col-12">
                <div class="empty-state">
                    <i class="bi bi-people"></i>
                    <p>Nenhum cliente cadastrado. Clique em "Novo Cliente" para começar.</p>
                </div>
            </div>
        </div>
    </div>

    <!-- Modal de Cadastro/Edição de Cliente -->
    <div class="modal fade" id="modalCliente" tabindex="-1">
        <div class="modal-dialog modal-lg">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="tituloModal">
                        <i class="bi bi-person-plus me-2"></i>Novo Cliente
                    </h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body">
                    <form id="formCliente">
                        <input type="hidden" id="clienteId">

                        <h6 class="mb-3"><i class="bi bi-person me-2"></i>Dados Pessoais</h6>

                        <div class="row">
                            <div class="col-md-8 mb-3">
                                <label class="form-label">Nome Completo *</label>
                                <input type="text" class="form-control" id="nome" required placeholder="Nome completo do cliente">
                            </div>
                            <div class="col-md-4 mb-3">
                                <label class="form-label">Data de Nascimento</label>
                                <input type="date" class="form-control" id="dataNascimento">
                            </div>
                        </div>

                        <div class="row">
                            <div class="col-md-6 mb-3">
                                <label class="form-label">CPF *</label>
                                <input type="text" class="form-control" id="cpf" required placeholder="000.000.000-00" maxlength="14">
                            </div>
                            <div class="col-md-6 mb-3">
                                <label class="form-label">RG</label>
                                <input type="text" class="form-control" id="rg" placeholder="00.000.000-0">
                            </div>
                        </div>

                        <h6 class="mb-3 mt-4"><i class="bi bi-envelope me-2"></i>Contato</h6>

                        <div class="row">
                            <div class="col-md-6 mb-3">
                                <label class="form-label">Email</label>
                                <input type="email" class="form-control" id="email" placeholder="cliente@email.com">
                            </div>
                            <div class="col-md-6 mb-3">
                                <label class="form-label">Telefone *</label>
                                <input type="text" class="form-control" id="telefone" required placeholder="(00) 00000-0000" maxlength="15">
                            </div>
                        </div>

                        <h6 class="mb-3 mt-4"><i class="bi bi-geo-alt me-2"></i>Endereço</h6>

                        <div class="row">
                            <div class="col-md-8 mb-3">
                                <label class="form-label">Endereço</label>
                                <input type="text" class="form-control" id="endereco" placeholder="Rua, número">
                            </div>
                            <div class="col-md-4 mb-3">
                                <label class="form-label">CEP</label>
                                <input type="text" class="form-control" id="cep" placeholder="00000-000" maxlength="9">
                            </div>
                        </div>

                        <div class="row">
                            <div class="col-md-6 mb-3">
                                <label class="form-label">Cidade</label>
                                <input type="text" class="form-control" id="cidade" placeholder="Cidade">
                            </div>
                            <div class="col-md-6 mb-3">
                                <label class="form-label">Estado</label>
                                <select class="form-select" id="estado">
                                    <option value="">Selecione</option>
                                    <option value="AC">Acre</option>
                                    <option value="AL">Alagoas</option>
                                    <option value="AP">Amapá</option>
                                    <option value="AM">Amazonas</option>
                                    <option value="BA">Bahia</option>
                                    <option value="CE">Ceará</option>
                                    <option value="DF">Distrito Federal</option>
                                    <option value="ES">Espírito Santo</option>
                                    <option value="GO">Goiás</option>
                                    <option value="MA">Maranhão</option>
                                    <option value="MT">Mato Grosso</option>
                                    <option value="MS">Mato Grosso do Sul</option>
                                    <option value="MG">Minas Gerais</option>
                                    <option value="PA">Pará</option>
                                    <option value="PB">Paraíba</option>
                                    <option value="PR">Paraná</option>
                                    <option value="PE">Pernambuco</option>
                                    <option value="PI">Piauí</option>
                                    <option value="RJ">Rio de Janeiro</option>
                                    <option value="RN">Rio Grande do Norte</option>
                                    <option value="RS">Rio Grande do Sul</option>
                                    <option value="RO">Rondônia</option>
                                    <option value="RR">Roraima</option>
                                    <option value="SC">Santa Catarina</option>
                                    <option value="SP">São Paulo</option>
                                    <option value="SE">Sergipe</option>
                                    <option value="TO">Tocantins</option>
                                </select>
                            </div>
                        </div>

                        <div class="row">
                            <div class="col-12 mb-3">
                                <label class="form-label">Observações</label>
                                <textarea class="form-control" id="observacoes" rows="3" placeholder="Informações adicionais sobre o cliente"></textarea>
                            </div>
                        </div>
                    </form>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancelar</button>
                    <button type="button" class="btn btn-success" onclick="salvarCliente()">
                        <i class="bi bi-save me-2"></i>Salvar
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- Bootstrap JS -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>

    <!-- Custom JS -->
    <script src="js/storage.js"></script>
    <script src="js/utils.js"></script>

    <script>
        let modalCliente;
        let clienteEditandoId = null;

        // Inicializar
        document.addEventListener('DOMContentLoaded', () => {
            modalCliente = new bootstrap.Modal(document.getElementById('modalCliente'));
            carregarClientes();

            // Máscaras
            document.getElementById('cpf').addEventListener('input', function() {
                Utils.aplicarMascaraCPF(this);
            });

            document.getElementById('telefone').addEventListener('input', function() {
                Utils.aplicarMascaraTelefone(this);
            });

            // Busca
            document.getElementById('busca').addEventListener('input', aplicarFiltros);
        });

        // Abrir modal
        function abrirModalCliente(clienteId = null) {
            clienteEditandoId = clienteId;

            if (clienteId) {
                const cliente = StorageManager.getClienteById(clienteId);
                if (!cliente) return;

                document.getElementById('tituloModal').innerHTML = '<i class="bi bi-pencil me-2"></i>Editar Cliente';
                document.getElementById('clienteId').value = cliente.id;
                document.getElementById('nome').value = cliente.nome;
                document.getElementById('cpf').value = cliente.cpf;
                document.getElementById('rg').value = cliente.rg || '';
                document.getElementById('dataNascimento').value = cliente.dataNascimento || '';
                document.getElementById('email').value = cliente.email || '';
                document.getElementById('telefone').value = cliente.telefone;
                document.getElementById('endereco').value = cliente.endereco || '';
                document.getElementById('cep').value = cliente.cep || '';
                document.getElementById('cidade').value = cliente.cidade || '';
                document.getElementById('estado').value = cliente.estado || '';
                document.getElementById('observacoes').value = cliente.observacoes || '';
            } else {
                document.getElementById('tituloModal').innerHTML = '<i class="bi bi-person-plus me-2"></i>Novo Cliente';
                document.getElementById('formCliente').reset();
                document.getElementById('clienteId').value = '';
            }

            modalCliente.show();
        }

        // Salvar cliente
        function salvarCliente() {
            const form = document.getElementById('formCliente');
            if (!form.checkValidity()) {
                form.reportValidity();
                return;
            }

            const cpf = document.getElementById('cpf').value;
            if (!Utils.validarCPF(cpf)) {
                alert('CPF inválido!');
                return;
            }

            const email = document.getElementById('email').value;
            if (email && !Utils.validarEmail(email)) {
                alert('Email inválido!');
                return;
            }

            const telefone = document.getElementById('telefone').value;
            if (!Utils.validarTelefone(telefone)) {
                alert('Telefone inválido!');
                return;
            }

            const cliente = {
                nome: document.getElementById('nome').value,
                cpf: cpf,
                rg: document.getElementById('rg').value,
                dataNascimento: document.getElementById('dataNascimento').value,
                email: email,
                telefone: telefone,
                endereco: document.getElementById('endereco').value,
                cep: document.getElementById('cep').value,
                cidade: document.getElementById('cidade').value,
                estado: document.getElementById('estado').value,
                observacoes: document.getElementById('observacoes').value
            };

            if (clienteEditandoId) {
                StorageManager.updateCliente(clienteEditandoId, cliente);
                Utils.showSuccess('Cliente atualizado com sucesso!');
            } else {
                StorageManager.addCliente(cliente);
                Utils.showSuccess('Cliente cadastrado com sucesso!');
            }

            modalCliente.hide();
            carregarClientes();
        }

        // Excluir cliente
        function excluirCliente(id) {
            // Verificar se o cliente tem vendas
            const vendas = StorageManager.getVendas();
            const temVendas = vendas.some(v => v.clienteId === id);

            if (temVendas) {
                alert('Este cliente possui vendas vinculadas e não pode ser excluído!');
                return;
            }

            if (!Utils.confirm('Tem certeza que deseja excluir este cliente?')) return;

            if (StorageManager.deleteCliente(id)) {
                Utils.showSuccess('Cliente excluído com sucesso!');
                carregarClientes();
            }
        }

        // Carregar clientes
        function carregarClientes() {
            aplicarFiltros();
        }

        // Aplicar filtros
        function aplicarFiltros() {
            let clientes = StorageManager.getClientes();

            // Busca
            const busca = document.getElementById('busca').value;
            if (busca) {
                clientes = Utils.filtrarPorTexto(clientes, busca, ['nome', 'cpf', 'email', 'telefone']);
            }

            // Ordenação
            const ordenacao = document.getElementById('ordenacao').value;
            switch(ordenacao) {
                case 'nome_asc':
                    clientes = Utils.ordenarPorNome(clientes, 'nome', 'asc');
                    break;
                case 'nome_desc':
                    clientes = Utils.ordenarPorNome(clientes, 'nome', 'desc');
                    break;
                case 'data_desc':
                    clientes = Utils.ordenarPorData(clientes, 'dataCadastro', 'desc');
                    break;
                case 'data_asc':
                    clientes = Utils.ordenarPorData(clientes, 'dataCadastro', 'asc');
                    break;
            }

            exibirClientes(clientes);
        }

        // Exibir clientes
        function exibirClientes(clientes) {
            const container = document.getElementById('cardsClientes');

            if (clientes.length === 0) {
                container.innerHTML = `
                    <div class="col-12">
                        <div class="empty-state">
                            <i class="bi bi-people"></i>
                            <p>Nenhum cliente encontrado.</p>
                        </div>
                    </div>
                `;
                return;
            }

            let html = '';
            clientes.forEach(cliente => {
                // Contar vendas do cliente
                const vendas = StorageManager.getVendas();
                const totalVendas = vendas.filter(v => v.clienteId === cliente.id).length;

                html += `
                    <div class="col-md-6 col-lg-4 mb-3">
                        <div class="card h-100">
                            <div class="card-body">
                                <h5 class="card-title">
                                    <i class="bi bi-person-circle me-2 text-primary"></i>
                                    ${cliente.nome}
                                </h5>
                                <hr>
                                <p class="card-text mb-2">
                                    <strong><i class="bi bi-credit-card me-2"></i>CPF:</strong>
                                    ${Utils.formatCPF(cliente.cpf)}
                                </p>
                                <p class="card-text mb-2">
                                    <strong><i class="bi bi-envelope me-2"></i>Email:</strong>
                                    ${cliente.email || 'Não informado'}
                                </p>
                                <p class="card-text mb-2">
                                    <strong><i class="bi bi-telephone me-2"></i>Telefone:</strong>
                                    ${Utils.formatPhone(cliente.telefone)}
                                </p>
                                <p class="card-text mb-2">
                                    <strong><i class="bi bi-cart me-2"></i>Vendas:</strong>
                                    <span class="badge bg-primary">${totalVendas}</span>
                                </p>
                                ${cliente.observacoes ? `
                                    <p class="card-text mb-2">
                                        <small class="text-muted">${cliente.observacoes}</small>
                                    </p>
                                ` : ''}
                            </div>
                            <div class="card-footer bg-transparent">
                                <button class="btn btn-sm btn-primary" onclick="abrirModalCliente('${cliente.id}')">
                                    <i class="bi bi-pencil me-1"></i>Editar
                                </button>
                                <button class="btn btn-sm btn-danger" onclick="excluirCliente('${cliente.id}')">
                                    <i class="bi bi-trash me-1"></i>Excluir
                                </button>
                            </div>
                        </div>
                    </div>
                `;
            });

            container.innerHTML = html;
        }
    </script>
</body>
</html>
